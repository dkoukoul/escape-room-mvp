/* ============================================================
   Glitch FX — CSS-only visual effects
   Intensity controlled by --glitch-intensity (0 to 1)
   ============================================================ */

/* ---- Glitch Overlay ---- */
.glitch-overlay {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 999;
  mix-blend-mode: screen;
  opacity: var(--glitch-intensity);
  transition: opacity 0.3s ease;
}

/* Chromatic Aberration — red/cyan shift */
.glitch-overlay::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    linear-gradient(
      transparent 0%,
      rgba(255, 0, 100, 0.04) 50%,
      transparent 100%
    );
  animation: glitchShift 0.15s infinite;
  opacity: var(--glitch-intensity);
}

.glitch-overlay::after {
  content: "";
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0, 240, 255, 0.015) 2px,
    rgba(0, 240, 255, 0.015) 4px
  );
  animation: glitchFlicker 0.08s infinite;
  opacity: var(--glitch-intensity);
}

/* ---- Scanlines ---- */
.scanlines {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 998;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 1px,
    rgba(0, 0, 0, 0.08) 1px,
    rgba(0, 0, 0, 0.08) 2px
  );
  opacity: 0.4;
}

/* ---- Screen Shake ---- */
.screen-shake {
  animation: screenShake 0.3s ease;
}

@keyframes screenShake {
  0%, 100% { transform: translate(0, 0); }
  10% { transform: translate(-3px, -2px); }
  20% { transform: translate(3px, 2px); }
  30% { transform: translate(-2px, 3px); }
  40% { transform: translate(2px, -3px); }
  50% { transform: translate(-3px, 1px); }
  60% { transform: translate(3px, -1px); }
  70% { transform: translate(-1px, 3px); }
  80% { transform: translate(1px, -2px); }
  90% { transform: translate(-2px, 2px); }
}

/* ---- Glitch Text Effect ---- */
.glitch-text {
  position: relative;
}

.glitch-text::before,
.glitch-text::after {
  content: attr(data-text);
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
}

.glitch-text::before {
  color: var(--neon-cyan);
  animation: glitchText1 3s infinite;
  clip-path: polygon(0 0, 100% 0, 100% 40%, 0 40%);
  transform: translate(-2px, -1px);
}

.glitch-text::after {
  color: var(--neon-magenta);
  animation: glitchText2 3s infinite;
  clip-path: polygon(0 60%, 100% 60%, 100% 100%, 0 100%);
  transform: translate(2px, 1px);
}

@keyframes glitchText1 {
  0%, 88%, 100% { opacity: 0; }
  89% { opacity: calc(var(--glitch-intensity) * 0.8); }
  90% { opacity: 0; }
  91% { opacity: calc(var(--glitch-intensity) * 0.6); }
  92% { opacity: 0; }
}

@keyframes glitchText2 {
  0%, 93%, 100% { opacity: 0; }
  94% { opacity: calc(var(--glitch-intensity) * 0.7); }
  95% { opacity: 0; }
  96% { opacity: calc(var(--glitch-intensity) * 0.5); }
  97% { opacity: 0; }
}

/* ---- Color Distortion on high glitch ---- */
@keyframes glitchShift {
  0% { transform: translate(0, 0); filter: hue-rotate(0deg); }
  25% { transform: translate(calc(var(--glitch-intensity) * 2px), calc(var(--glitch-intensity) * -1px)); }
  50% { transform: translate(calc(var(--glitch-intensity) * -1px), calc(var(--glitch-intensity) * 2px)); filter: hue-rotate(calc(var(--glitch-intensity) * 30deg)); }
  75% { transform: translate(calc(var(--glitch-intensity) * 1px), calc(var(--glitch-intensity) * -2px)); }
  100% { transform: translate(0, 0); filter: hue-rotate(0deg); }
}

@keyframes glitchFlicker {
  0%, 100% { opacity: var(--glitch-intensity); }
  50% { opacity: calc(var(--glitch-intensity) * 0.5); }
}

/* ---- Glitch Block — random color strip that appears on high glitch ---- */
.glitch-block {
  position: fixed;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--neon-magenta);
  z-index: 1000;
  pointer-events: none;
  opacity: 0;
  animation: glitchBlockAppear 4s infinite;
}

.glitch-block:nth-child(1) { top: 15%; animation-delay: 0s; }
.glitch-block:nth-child(2) { top: 45%; animation-delay: 1.5s; background: var(--neon-cyan); }
.glitch-block:nth-child(3) { top: 78%; animation-delay: 3s; }

@keyframes glitchBlockAppear {
  0%, 95%, 100% { opacity: 0; transform: scaleX(0); }
  96% { opacity: var(--glitch-intensity); transform: scaleX(1); }
  97% { opacity: 0; }
  98% { opacity: calc(var(--glitch-intensity) * 0.5); transform: scaleX(0.7); }
  99% { opacity: 0; }
}

/* ---- VHS Noise flash (high glitch) ---- */
.vhs-noise {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 997;
  opacity: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  animation: vhsFlash 6s infinite;
}

@keyframes vhsFlash {
  0%, 97%, 100% { opacity: 0; }
  98% { opacity: calc(var(--glitch-intensity) * 0.1); }
  99% { opacity: 0; }
}

/* ---- Matrix Screen Glitch ---- */
.matrix-glitch-active {
  animation: matrixGlitch 0.5s ease infinite;
  filter: sepia(0.2) hue-rotate(80deg) brightness(1.1) contrast(1.2);
}

@keyframes matrixGlitch {
  0% {
    transform: translate(0);
    clip-path: inset(0 0 0 0);
  }
  10% {
    transform: translate(-5px, -2px) scale(1.02) skewX(1deg);
    clip-path: inset(10% 0 85% 0);
  }
  20% {
    transform: translate(5px, 2px) scale(0.98) skewX(-1deg);
    clip-path: inset(80% 0 5% 0);
  }
  30% {
    transform: translate(-2px, 5px);
    clip-path: inset(40% 0 45% 0);
  }
  40% {
    transform: translate(2px, -5px);
    clip-path: inset(60% 0 25% 0);
  }
  50% {
    transform: translate(-8px, 2px);
    clip-path: inset(20% 0 70% 0);
  }
  60% {
    transform: translate(8px, -2px);
    clip-path: inset(50% 0 5% 0);
  }
  70% {
    transform: translate(-3px, 8px);
    clip-path: inset(15% 0 80% 0);
  }
  80% {
    transform: translate(3px, -8px);
    clip-path: inset(75% 0 10% 0);
  }
  90% {
    transform: translate(-5px, 5px);
    clip-path: inset(30% 0 60% 0);
  }
  100% {
    transform: translate(0);
    clip-path: inset(0 0 0 0);
  }
}

.matrix-glitch-active::before {
  content: "";
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    rgba(0, 255, 70, 0.1) 0px,
    rgba(0, 255, 70, 0.1) 1px,
    transparent 1px,
    transparent 2px
  );
  pointer-events: none;
  z-index: 1001;
  animation: matrixScanlines 0.2s linear infinite;
}

@keyframes matrixScanlines {
  from { transform: translateY(0); }
  to { transform: translateY(2px); }
}
